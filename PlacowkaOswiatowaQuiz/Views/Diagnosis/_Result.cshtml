@model ResultViewModel

<form method="post" asp-controller="Diagnosis" asp-action="SaveResult" id="partialResultForm">
    <input type="hidden" asp-for="@Model.DiagnosisId"/>
    <div class="container-fluid">
        @*@Html.LabelFor(m => m.QuestionsSetRating,
        htmlAttributes: new { @class = "control-label col-md-10" })*@
        @*<div class="col-md-10">
        @Html.DropDownListFor(m => Model.Result.QuestionsSetRating.Id,
            new SelectList(Model.QuestionsSetRatings, "Id", "RatingDescription"),
            htmlAttributes: new { @class = "form-control form-control-lg" })
        @Html.ValidationMessageFor(m => m.Result.QuestionsSetRating, "", new { @class = "text-danger" })*@
        <div class="row mb-3 form-group">
            <label asp-for="@Model.QuestionsSetRating" class="form-label col-md-10"></label>
            <div class="col-sm-8">
                <select asp-for="@Model.QuestionsSetRating.Id" class="form-select" id="ratingsDropdown"
                        currentRatingId="@Model.QuestionsSetRating?.Id">
                    <option disabled selected>Wybierz ocenę...</option>
                </select>
            </div>
        </div>
        <div class="row mb-3 form-group">
            @Html.LabelFor(m => m.RatingLevel,
                htmlAttributes: new { @class = "control-label col-md-10" })
            <div class="col-md-2">
                @Html.DropDownListFor(m => m.RatingLevel,
                    new SelectList(Enumerable.Range(1, 6).Select(i => (byte)i), "--Wybierz poziom--"),
                    htmlAttributes: new { @class = "form-control form-control-lg" })
                @Html.ValidationMessageFor(m => m.RatingLevel, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="row mb-3">
            <label asp-for="@Model.Notes" class="col-sm-2 col-form-label"></label>
            <div class="col-sm-10">
                <textarea asp-for="@Model.Notes" type="text" class="form-control"
                          placeholder="Notatki..." rows="3"></textarea>
            </div>
        </div>
        <div id="divAlertArea">
            <partial name="~/Views/UIComponents/_bootstrapAlert.cshtml" />
        </div>
        <div class="d-grid col-4 mx-auto">
            @*<button class="btn btn-success" type="submit">zapisz</button>*@
            <a class="btn btn-success" id="saveResult">Zapisz</a>
        </div>
    </div>
</form>

<script>
    $(document).ready(function () {
        var currentRatingId = $("#ratingsDropdown").attr('currentRatingId');
        $.ajax({
            type: "GET",
            url: "/QuestionsSet/GetQuestionsSetRatings?questionsSetId=" +
                @ViewData["questionsSetId"],
            data: "{}",
            success: function (data) {
                $.each(data, function (i, rating) {
                    if (rating.id != currentRatingId)
                        $("#ratingsDropdown").append(
                            "<option value=" + rating.id + ">" +
                            rating.ratingDescription + "</option>");
                    else
                        $("#ratingsDropdown").append(
                            "<option selected value=" + rating.id + ">" +
                            rating.ratingDescription + "</option>");
                });
            }
        });
    });

    $("#saveResult").click(function () {
        $.ajax({
            url: "/Diagnosis/SaveResult",
            type: "post",
            data: $("form").serialize(),
            success: function (result) {
                $("#partialResult").html(result);
            }
        });
    })
</script>